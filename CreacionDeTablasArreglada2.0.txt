CREATE TABLE dbo.Usuario
(
    Id INT IDENTITY(1,1) PRIMARY KEY
    ,NombreUsuario VARCHAR(32)
	,Pin VARCHAR(32)
	,IdTH INT -- FK TH
    ,EsAdmin BIT
)
CREATE TABLE dbo.TipoDeTH
(
    Id INT IDENTITY(1,1) PRIMARY KEY
    ,Tipo VARCHAR(32)
	,Formato VARCHAR(32)
)


CREATE TABLE dbo.TH
(
    Id INT IDENTITY(1,1) PRIMARY KEY
    ,Nombre VARCHAR(32)
	,IdUsuario INT
	,IdCTM INT  -- FK CTM
	,IdCTA INT -- FK CTA
    ,IdTDTH INT -- FK TDTH
)


CREATE TABLE dbo.CTM
(
    Id INT NOT NULL PRIMARY KEY  --
	, Saldo INT
	, PagoMinimo INT
	, SaldoCorteEC INT
	, FechaCorte DATE
	, SaldoInteresesCorrientes INT
	, IdTCT INT NOT NULL -- FK TCT
    , IdTH INT NOT NULL -- FK TH
	, IdCTA INT -- FK CTA
	, IdEC INT NOT NULL -- FK EC
	, IdMS INT NOT NULL -- FK MS
	, IdMov INT NOT NULL -- FK Mov
	, IdTCTM INT NOT NULL -- FK TCTM
);

CREATE TABLE dbo.TCTM
(
	Id INT IDENTITY(1,1) PRIMARY KEY
	,Nombre VARCHAR(32)
);

CREATE TABLE dbo.CTA
(

  Id INT NOT NULL PRIMARY KEY
  , IdTCM INT NOT NULL --FK CTM
  , IdTH INT NOT NULL -- FK TH

);


CREATE TABLE dbo.CT
(
  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , EsMaestra BIT NOT NULL 
  , PinCajero INT NOT NULL -- Codigo de la tarjeta para usar el cajero
);
CREATE TABLE dbo.TF
(
  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR(32)
  , FechaCaducacion VARCHAR(32)
  , CCV INT NOT NULL -- Codigo de la tarjeta asociada
  , Codigo INT NOT NULL -- Codigo de la tarjeta asociada
  , IdCT INT  --FK CT
  , IdMI INT  --FK MI
  , IdMS INT  --FK MS
);


CREATE TABLE dbo.EC
(
  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  ,Fecha VARCHAR(32)
  ,IdMov INT NOT NULL --FK Movimiento
);



CREATE TABLE dbo.MovimientoSospechoso
(
  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  ,Monto INT NOT NULL
  ,Fecha VARCHAR(32)
  ,Descripcion VARCHAR(32)
  ,IdTF INT NOT NULL --FK TF
);




CREATE TABLE dbo.MotivoInvalidacion
(

    Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
    , Nombre VARCHAR (64)

);
CREATE TABLE dbo.TMTI
(

  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR (64)  
  , Accion VARCHAR (16) --DEBITO O CREDITO

);
CREATE TABLE dbo.Movimiento
(

  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR (64)  
  , Fecha DATE
  , Monto MONEY
  , Descripcion VARCHAR (32)
  , Referencia VARCHAR (32)
  , IdTM INT --FK TM
  , IdTMTI INT --FK TMTI
  
);



CREATE TABLE dbo.RN
(

  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR (64)  
  , IdTRN INT --FK TRN
  , IdTCTM INT NOT NULL -- FK TCTM

);



CREATE TABLE dbo.TCTXRN
(

  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR (64)  
  , IdRN INT --FK RN

);

CREATE TABLE dbo.TRN
(

  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR (64)  
  , Tipo VARCHAR (32) --LIMITE
);

CREATE TABLE dbo.TCT
(

  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR (64)  
  , IdTCTXRN INT -- FK TCTXRN

);


CREATE TABLE dbo.TCTXRNQDias
(

  Id INT NOT NULL PRIMARY KEY
  , QDias VARCHAR (64)  
);



CREATE TABLE dbo.TCTXRNTasa
(
  Id INT NOT NULL PRIMARY KEY
  , Tasa VARCHAR (64)  
);



CREATE TABLE dbo.TCTXRNMM
(
  Id INT NOT NULL PRIMARY KEY
  , Monto VARCHAR (64)  
);



CREATE TABLE dbo.TCTXRNQMes
( 
  Id INT NOT NULL PRIMARY KEY
  , QMes VARCHAR (64)  
);


CREATE TABLE dbo.TCTXRNQOP
(

  Id INT NOT NULL PRIMARY KEY
  , QOperaciones VARCHAR (64)  
);



CREATE TABLE dbo.TM
(

  Id INT IDENTITY (1, 1) NOT NULL PRIMARY KEY
  , Nombre VARCHAR (64)  
  , Accion VARCHAR (64)
  , Acumula_Operacion_ATM VARCHAR (8)
  , Acumula_Operacion_Ventana VARCHAR (8)

);

CREATE TABLE dbo.EventLog (
 Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY
 , LogDescription VARCHAR (2048) NOT NULL
 , PostIdUser INT NOT NULL
 , PostIP VARCHAR(64) NOT NULL
 , PostTime DATETIME NOT NULL
);


ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_TCTM] FOREIGN KEY([IdTCTM])
REFERENCES [dbo].[TCTM] ([Id])

ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_CT] FOREIGN KEY([Id])
REFERENCES [dbo].[CT] ([Id])

ALTER TABLE [dbo].[CTA] WITH CHECK ADD CONSTRAINT
[FK_CTA_CT] FOREIGN KEY([Id])
REFERENCES [dbo].[CT] ([Id])


ALTER TABLE [dbo].[Usuario] WITH CHECK ADD CONSTRAINT
[FK_Usuario_TH] FOREIGN KEY([IdTH])
REFERENCES [dbo].[TH] ([id])

ALTER TABLE [dbo].[TCTXRNQDias] WITH CHECK ADD CONSTRAINT
[FK_TCTXRNQDias_TCTXRN] FOREIGN KEY([Id])
REFERENCES [dbo].[TCTXRN] ([Id])

ALTER TABLE [dbo].[TCTXRNTasa] WITH CHECK ADD CONSTRAINT
[FK_TCTXRNTasa_TCTXRN] FOREIGN KEY([Id])
REFERENCES [dbo].[TCTXRN] ([Id])

ALTER TABLE [dbo].[TCTXRNMM] WITH CHECK ADD CONSTRAINT
[FK_TCTXRNMM_TCTXRN] FOREIGN KEY([Id])
REFERENCES [dbo].[TCTXRN] ([Id])

ALTER TABLE [dbo].[TCTXRNQMes] WITH CHECK ADD CONSTRAINT
[FK_TCTXRNQMes_TCTXRN] FOREIGN KEY([Id])
REFERENCES [dbo].[TCTXRN] ([Id])


ALTER TABLE [dbo].[TCTXRNQOP] WITH CHECK ADD CONSTRAINT
[FK_TCTXRNQOP_TCTXRN] FOREIGN KEY([Id])
REFERENCES [dbo].[TCTXRN] ([Id])


ALTER TABLE [dbo].[TH] WITH CHECK ADD CONSTRAINT
[FK_TH_CTM] FOREIGN KEY([IdCTM])
REFERENCES [dbo].[CTM] ([Id])

ALTER TABLE [dbo].[TH] WITH CHECK ADD CONSTRAINT
[FK_TH_CTA] FOREIGN KEY([IdCTA])
REFERENCES [dbo].[CTA] ([Id])

ALTER TABLE [dbo].[TH] WITH CHECK ADD CONSTRAINT
[FK_TH_TipoDeTh] FOREIGN KEY([IdTDTH])
REFERENCES [dbo].[TipoDeTh] ([Id])



ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_TCT] FOREIGN KEY([IdTCT])
REFERENCES [dbo].[TCT] ([id])

ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_TH] FOREIGN KEY([IdTH])
REFERENCES [dbo].[TH] ([id])


ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_CTA] FOREIGN KEY([IdCTA])
REFERENCES [dbo].[CTA] ([id])

ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_EC] FOREIGN KEY([IdEC])
REFERENCES [dbo].[EC] ([id])

ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_MovimientoSospechoso] FOREIGN KEY([IdMS])
REFERENCES [dbo].[MovimientoSospechoso] ([id])

ALTER TABLE [dbo].[CTM] WITH CHECK ADD CONSTRAINT
[FK_CTM_Movimiento] FOREIGN KEY([IdMov])
REFERENCES [dbo].[Movimiento] ([id])




ALTER TABLE [dbo].[CTA] WITH CHECK ADD CONSTRAINT
[FK_CTA_CTM] FOREIGN KEY([IdTCM])
REFERENCES [dbo].[CTM] ([id])


ALTER TABLE [dbo].[CTA] WITH CHECK ADD CONSTRAINT
[FK_CTA_TH] FOREIGN KEY([IdTH])
REFERENCES [dbo].[TH] ([id])





ALTER TABLE [dbo].[TF] WITH CHECK ADD CONSTRAINT
[FK_TF_MotivoInvalidacion] FOREIGN KEY([IdMI])
REFERENCES [dbo].[MotivoInvalidacion] ([id])

ALTER TABLE [dbo].[TF] WITH CHECK ADD CONSTRAINT
[FK_TF_MovimientoSospechoso] FOREIGN KEY([IdMS])
REFERENCES [dbo].[MovimientoSospechoso] ([id])



ALTER TABLE [dbo].[EC] WITH CHECK ADD CONSTRAINT
[FK_EC_Movimiento] FOREIGN KEY([IdMov])
REFERENCES [dbo].[Movimiento] ([id])





ALTER TABLE [dbo].[MovimientoSospechoso] WITH CHECK ADD CONSTRAINT
[FK_MovimientoSospechoso_TF] FOREIGN KEY([IdTF])
REFERENCES [dbo].[TF] ([id])



ALTER TABLE [dbo].[Movimiento] WITH CHECK ADD CONSTRAINT
[FK_Movimiento_TM] FOREIGN KEY([IdTM])
REFERENCES [dbo].[TM] ([id])

ALTER TABLE [dbo].[Movimiento] WITH CHECK ADD CONSTRAINT
[FK_Movimiento_TMTI] FOREIGN KEY([IdTMTI])
REFERENCES [dbo].[TMTI] ([id])




ALTER TABLE [dbo].[RN] WITH CHECK ADD CONSTRAINT
[FK_RN_TRN] FOREIGN KEY([IdTRN])
REFERENCES [dbo].[TRN] ([id])

ALTER TABLE [dbo].[RN] WITH CHECK ADD CONSTRAINT
[FK_RN_TCTM] FOREIGN KEY([IdTCTM])
REFERENCES [dbo].[TCTM] ([id])


ALTER TABLE [dbo].[TCTXRN] WITH CHECK ADD CONSTRAINT
[FK_TCTXRN_RN] FOREIGN KEY([IdRN])
REFERENCES [dbo].[RN] ([id])


ALTER TABLE [dbo].[TCT] WITH CHECK ADD CONSTRAINT
[FK_TCT_TCTXRN] FOREIGN KEY([IdTCTXRN])
REFERENCES [dbo].[TCTXRN] ([id])